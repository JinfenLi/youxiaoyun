<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.topview.school.dao.ParentMapper">
	<resultMap id="BaseResultMap" type="com.topview.school.po.Parent">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		<id column="id" property="id" jdbcType="CHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="CHAR" />
		<result column="parentType" property="parenttype" jdbcType="VARCHAR" />
		<result column="mobile" property="mobile" jdbcType="VARCHAR" />
		<result column="IDCard" property="idcard" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="type" property="type" jdbcType="INTEGER" />
		<result column="password" property="password" jdbcType="VARCHAR" />
		<result column="super_password" property="superPassword"
			jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		id, name, sex, parentType, mobile, IDCard, create_time, type,
		password, super_password
	</sql>


	<select id="findByNameAndPassword" resultMap="BaseResultMap">
		select * from t_sc_parent where 1 = 1
		<if test="params != null">
			<foreach item="item" index="key" collection="params.entrySet()">
				and ${key} =
				#{item}
			</foreach>
		</if>
	</select>

	<select id="findByAccount" resultMap="BaseResultMap">
		select * from t_sc_parent p
		where p.mobile=#{mobile}
	</select>

	<select id="selectByStudentId" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		select
		p.*
		from t_sc_parent p,
		t_sc_parent_student ps
		where ps.student_id
		= #{id,jdbcType=CHAR}
		and ps.parent_id = p.id
	</select>

	<!-- 根据学生id查询主家长 -->
	<select id="selectMainParent" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		select
		p.*
		from t_sc_parent p,
		t_sc_parent_student ps
		where
		ps.student_id
		= #{studentId,jdbcType=CHAR}
		and ps.parent_id = p.id and
		p.parentType = '1'
	</select>

	<resultMap type="com.topview.school.vo.contacts.ContactsInfo"
		id="parentContact">
		<id property="id" column="t_sc_parent.id" />
		<result property="sex" column="t_sc_parent.sex" />
		<result property="phone" column="mobile" />
		<result property="name" column="t_sc_parent.name" />
		<result property="picUrl" column="t_sc_student.picUrl" />
		<result property="lastUpdate" column="t_sc_student.lastUpdate" />
		<result property="studentName" column="t_sc_student.name" />
	</resultMap>

	<!--根据班级id查看本班学生家长通讯录，适用于老师身份查看和家长身份查看 -->
	<select id="selectContactByClassId" parameterType="java.lang.String"
		resultMap="parentContact">
		select
		p.id, p.name, p.sex, p.mobile, s.name as studentName,
		s.picUrl,
		s.lastUpdate
		from
		t_sc_class as c,
		t_sc_student as s,
		t_sc_parent_student as ps,
		t_sc_parent as p
		where
		c.id=#{class_id}
		and
		s.t_sc_class_id = c.id
		and
		ps.student_id = s.id
		and
		p.id = ps.parent_id
	</select>

	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		select
		<include refid="Base_Column_List" />
		from t_sc_parent
		where id = #{id,jdbcType=CHAR}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		delete from t_sc_parent
		where id = #{id,jdbcType=CHAR}
	</delete>
	<insert id="insert" parameterType="com.topview.school.po.Parent">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		insert into t_sc_parent (id, name, sex, parentType,
		mobile, IDCard,
		create_time,
		type, password, super_password
		)
		values
		(#{id,jdbcType=CHAR}, #{name,jdbcType=VARCHAR}, #{sex,jdbcType=CHAR},
		#{parenttype,jdbcType=VARCHAR},
		#{mobile,jdbcType=VARCHAR},
		#{idcard,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},
		#{type,jdbcType=INTEGER}, #{password,jdbcType=VARCHAR},
		#{superPassword,jdbcType=VARCHAR}
		)
	</insert>
	<insert id="insertSelective" parameterType="com.topview.school.po.Parent">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		insert into t_sc_parent
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="sex != null">
				sex,
			</if>
			<if test="parenttype != null">
				parentType,
			</if>
			<if test="mobile != null">
				mobile,
			</if>
			<if test="idcard != null">
				IDCard,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="type != null">
				type,
			</if>
			<if test="password != null">
				password,
			</if>
			<if test="superPassword != null">
				super_password,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=CHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				#{sex,jdbcType=CHAR},
			</if>
			<if test="parenttype != null">
				#{parenttype,jdbcType=VARCHAR},
			</if>
			<if test="mobile != null">
				#{mobile,jdbcType=VARCHAR},
			</if>
			<if test="idcard != null">
				#{idcard,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="type != null">
				#{type,jdbcType=INTEGER},
			</if>
			<if test="password != null">
				#{password,jdbcType=VARCHAR},
			</if>
			<if test="superPassword != null">
				#{superPassword,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.topview.school.po.Parent">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		update t_sc_parent
		<set>
			<if test="name != null and name != ''">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="sex != null and sex != ''">
				sex = #{sex,jdbcType=CHAR},
			</if>
			<if test="parenttype != null and parenttype != ''">
				parentType = #{parenttype,jdbcType=VARCHAR},
			</if>
			<if test="mobile != null and mobile != ''">
				mobile = #{mobile,jdbcType=VARCHAR},
			</if>
			<if test="idcard != null and idcard != ''">
				IDCard = #{idcard,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null and createTime != ''">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="type != null and type != ''">
				type = #{type,jdbcType=INTEGER},
			</if>
			<if test="password != null and password != ''">
				password = #{password,jdbcType=VARCHAR},
			</if>
			<if test="superPassword != null and superPassword != ''">
				super_password = #{superPassword,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=CHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.topview.school.po.Parent">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed May 06 
			23:49:52 CST 2015. -->
		update t_sc_parent
		set name = #{name,jdbcType=VARCHAR},
		sex =
		#{sex,jdbcType=CHAR},
		parentType = #{parenttype,jdbcType=VARCHAR},
		mobile = #{mobile,jdbcType=VARCHAR},
		IDCard =
		#{idcard,jdbcType=VARCHAR},
		create_time =
		#{createTime,jdbcType=TIMESTAMP},
		type = #{type,jdbcType=INTEGER},
		password = #{password,jdbcType=VARCHAR},
		super_password =
		#{superPassword,jdbcType=VARCHAR}
		where id = #{id,jdbcType=CHAR}
	</update>


	<!--根据家长姓名和手机号码 -->
	<select id="findByNameAndPhone" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		select
		*
		from
		t_sc_parent
		where
		name = #{name,jdbcType=VARCHAR}
		and
		mobile = #{phone,jdbcType=VARCHAR}
	</select>

	<!-- 自定义家长通讯录结果类型 -->
	<resultMap type="com.topview.school.vo.contacts.ParentContact"
		id="parentContacts">
		<id property="parentId" column="t_sc_parent.id" />
		<result property="parentName" column="t_sc_parent.name" />
		<result property="parentSex" column="t_sc_parent.sex" />
		<result property="parentPhone" column="t_sc_parent.mobile" />
		<result property="parentType" column="t_sc_parent.parentType" />

		<result property="studentId" column="t_sc_student.id" />
		<result property="clazzId" column="t_sc_student.t_sc_class_id" />
		<result property="studentName" column="t_sc_student.name" />
		<result property="studentSex" column="t_sc_student.sex" />
		<result property="studentIdCard" column="t_sc_student.IDCard" />
		<result property="picUrl" column="t_sc_student.picUrl" />
		<result property="lastUpdate" column="t_sc_student.lastUpdate" />
	</resultMap>

	<!-- 根据班级id获取家长通讯录 -->
	<select id="getParentContacts" parameterType="java.lang.String"
		resultMap="parentContacts">
		select
		p.id as parentId, p.name as parentName, p.sex as
		parentSex, p.mobile as parentPhone, p.parentType as parentType, s.id
		as studentId, s.t_sc_class_id as clazzId, s.name as studentName, s.sex
		as studentSex, s.IDCard as studentIdCard, s.picUrl as picUrl,
		s.lastUpdate as lastUpdate
		from
		t_sc_class as c,
		t_sc_student as s,
		t_sc_parent_student
		as ps,
		t_sc_parent as p
		where
		c.id=#{class_id}
		and
		s.t_sc_class_id = c.id
		and
		ps.student_id = s.id
		and
		p.id = ps.parent_id
	</select>
</mapper>