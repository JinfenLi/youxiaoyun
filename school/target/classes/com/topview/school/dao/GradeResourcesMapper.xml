<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.topview.school.dao.GradeResourcesMapper" >
  <resultMap id="BaseResultMap" type="com.topview.school.po.GradeResources" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="resourcePath" property="resourcepath" jdbcType="VARCHAR" />
    <result column="grade_id" property="gradeId" jdbcType="VARCHAR" />
    <result column="t_sc_resource_id" property="resourceTypeId" jdbcType="VARCHAR"/>
    <result column="upload_time" property="uploadTime" jdbcType="TIMESTAMP"/>
    <result column="is_link" property="isLink" jdbcType="BIT"/>
    <result column="thumbnail" property="thumbnailPath" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    id, name, resourcePath, grade_id,t_sc_resource_id,upload_time,is_link,thumbnail
  </sql>
  
  <sql id="page">
  	<if test="offset != null">
		limit #{offset}
	</if>
	<if test="limit != null">
		, #{limit}
	</if>
  </sql>
  <select id="getResourceById" resultMap="BaseResultMap" parameterType="java.lang.String">
  	select r.* 
  	from t_sc_grade_resources r  
  	where r.id=#{resourceId}
  </select>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_sc_grade_resources
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    delete from t_sc_grade_resources
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.topview.school.po.GradeResources" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    insert into t_sc_grade_resources (id, name, resourcePath, 
      grade_id,t_sc_resource_id,upload_time,is_link,thumbnail)
    values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{resourcepath,jdbcType=VARCHAR}, 
      #{gradeId,jdbcType=VARCHAR},#{resourceTypeId,jdbcType=VARCHAR},#{uploadTime,jdbcType=TIMESTAMP},
      #{isLink,jdbcType=BIT},#{thumbnailPath,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.topview.school.po.GradeResources" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    insert into t_sc_grade_resources
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="resourcepath != null" >
        resourcePath,
      </if>
      <if test="gradeId != null" >
        grade_id,
      </if>
        <if test="resourceTypeId != null" >
        t_sc_resource_id,
      </if>
      <if test="uploadTime != null" >
        upload_time,
      </if>
       <if test="isLink != null" >
        is_link,
      </if>
      <if test="thumbnailPath!=null">
      	thumbnail
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="resourcepath != null" >
        #{resourcepath,jdbcType=VARCHAR},
      </if>
      <if test="gradeId != null" >
        #{gradeId,jdbcType=VARCHAR},
      </if>
        <if test="resourceTypeId != null" >
        #{resourceTypeId,jdbcType=VARCHAR},
      </if>
      <if test="uploadTime != null" >
        #{uploadTime},
      </if>
      <if test="isLink != null" >
        #{isLink},
      </if>
      <if test="thumbnailPath!=null">
      #{thumbnail}
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.topview.school.po.GradeResources" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    update t_sc_grade_resources
    <set >
      <if test="name != null and name != ''" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="resourcepath != null and resourcepath != ''" >
        resourcePath = #{resourcepath,jdbcType=VARCHAR},
      </if>
      <if test="gradeId != null and gradeId != ''" >
        grade_id = #{gradeId,jdbcType=VARCHAR},
      </if>
      <if test="schoolId != null and schoolId != ''" >
        t_sc_resouce_id = #{resourceTypeId,jdbcType=VARCHAR},
      </if>
      <if test="uploadTime != null and uploadTime != ''" >
        upload_time = #{uploadTime},
      </if>
      <if test="isLink != null and isLink != ''" >
        is_link = #{isLink},
      </if>
      <if test="thumbnailPath!=null">
      	thumbnail=#{thumbPath}
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.topview.school.po.GradeResources" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 13 15:24:46 CST 2015.
    -->
    update t_sc_grade_resources
    set name = #{name,jdbcType=VARCHAR},
      resourcePath = #{resourcepath,jdbcType=VARCHAR},
      grade_id = #{gradeId,jdbcType=VARCHAR},
      t_sc_school_id = #{schoolId,jdbcType=VARCHAR},
      upload_time = #{uploadTime},
      is_link = #{isLink},
      thumbnail=#{thumbnailPath}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
<!--   <insert id="insertType" parameterType="java.util.Map">
  	insert into t_sc_resource_type2 
  	<trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="resourceId != null" >
        resource_id,
      </if>
      <if test="typeId != null" >
        type_id
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="resourceId != null" >
        #{resourceId},
      </if>
      <if test="typeId != null" >
        #{typeId}
      </if>
    </trim>
  </insert> -->
  
<!--   <select id="getAllGradeResource" parameterType="java.util.Map" resultMap="BaseResultMap">
  	select r.* from t_sc_grade_resources r , 
  	t_sc_resource_type2 t where 1=1 
  	  <if test="gradeId != null and gradeId != ''" >
        and r.grade_id = #{gradeId}
        and r.id = t.resource_id
      </if>
      <if test="typeId != null and typeId != ''" >
        and t.type_id = #{typeId}
  	    and t.resource_id = r.id
      </if>
  	order by upload_time DESC
  	<include refid="page" />
  </select>
   -->
  <!-- 通过SCHOOLID来获取学校内的资源 -->
  <select id="getAllSchoolResource" parameterType="java.util.Map" resultMap="BaseResultMap">
  	select distinct r.* from t_sc_grade_resources r , 
  	t_sc_grade_resources_type t,
  	t_sc_school s where 1=1 
  	  <if test="resourceTypeId != null and resourceTypeId != ''" >
        and r.t_sc_resource_id = t.id
        and t.t_sc_school_Id = #{schoolId}
      </if>
  	order by upload_time DESC
  	<include refid="page" />
  </select>
  
<!--   <select id="getCountByGrade" parameterType="java.util.Map" resultType="java.lang.Integer">
  	select count(*) from t_sc_grade_resources r , 
  	t_sc_resource_type2 t where 1=1 
  	  <if test="gradeId != null and gradeId != ''" >
        and r.grade_id = #{gradeId}
        and r.id = t.resource_id
      </if>
      <if test="typeId != null and typeId != ''" >
        and t.type_id = #{typeId}
  	    and t.resource_id = r.id
      </if>
  </select> -->
  
   <!-- 获取校内资源总数 -->
   <select id="getCountBySchool" parameterType="java.util.Map" resultType="java.lang.Integer">
  	select  count(distinct r.id) from t_sc_grade_resources r , 
  	t_sc_grade_resources_type t,
  	t_sc_school s where 1=1 
  	  <if test="resourceTypeId != null and resourceTypeId != ''" >
        and r.t_sc_resource_id = t.id
        and t.t_sc_school_Id = #{schoolId}
      </if>
  	order by upload_time DESC
  	<include refid="page" />
  </select>
  
  <select id="getCountByType" parameterType="java.lang.String" resultType="java.lang.Integer">
  	select count(*) 
  	from t_sc_grade_resources resources,
  	where resources.t_sc_resource_id = #{typeId}
  </select>
  
  <select id="getResourcesByType" parameterType="java.util.Map" resultMap="BaseResultMap">
  	select resources.*
  	from t_sc_grade_resources resources,
  	where
  	resources.t_sc_resource_id=#{typeId}
  	order by upload_time DESC
  	<include refid="page" />
  </select>
  
  <select id="getResourceType" parameterType="java.lang.String" resultType="java.lang.String">
  	select r.name
  	from t_sc_grade_resources r
  	where r.t_sc_resource_id=#{resourceId}
  </select>
  
<!--   <select id="getResourceById" parameterType="java.lang.String" resultType="BaseResultMap">
  	select r.* 
  	from t_sc_grade_resources r  
  	where r.id=#{resourceId}
  </select> -->

</mapper>