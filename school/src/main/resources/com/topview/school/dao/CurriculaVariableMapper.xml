<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.topview.school.dao.CurriculaVariableMapper">
	<resultMap id="BaseResultMap" type="com.topview.school.po.CurriculaVariable">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		<id column="id" jdbcType="CHAR" property="id" />
		<result column="t_sc_curricula_id" jdbcType="CHAR" property="tScCurriculaId" />
		<result column="t_sc_teacher_id" jdbcType="VARCHAR" property="tScTeacherId" />
		<result column="t_sc_class_id" jdbcType="CHAR" property="tScClassId" />
		<result column="t_sc_semester_id" jdbcType="CHAR" property="tScSemesterId" />
		<result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		id, t_sc_curricula_id, t_sc_teacher_id, t_sc_class_id,
		t_sc_semester_id, create_time
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		select
		<include refid="Base_Column_List" />
		from t_sc_curricula_variable
		where id = #{id,jdbcType=CHAR}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		delete from t_sc_curricula_variable
		where id = #{id,jdbcType=CHAR}
	</delete>
	<insert id="insert" parameterType="com.topview.school.po.CurriculaVariable">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		insert into t_sc_curricula_variable (id, t_sc_curricula_id,
		t_sc_teacher_id,
		t_sc_class_id, t_sc_semester_id, create_time
		)
		values
		(#{id,jdbcType=CHAR}, #{tScCurriculaId,jdbcType=CHAR},
		#{tScTeacherId,jdbcType=VARCHAR},
		#{tScClassId,jdbcType=CHAR},
		#{tScSemesterId,jdbcType=CHAR}, #{createTime,jdbcType=TIMESTAMP}
		)
	</insert>
	<insert id="insertSelective" parameterType="com.topview.school.po.CurriculaVariable">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		insert into t_sc_curricula_variable
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="tScCurriculaId != null">
				t_sc_curricula_id,
			</if>
			<if test="tScTeacherId != null">
				t_sc_teacher_id,
			</if>
			<if test="tScClassId != null">
				t_sc_class_id,
			</if>
			<if test="tScSemesterId != null">
				t_sc_semester_id,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=CHAR},
			</if>
			<if test="tScCurriculaId != null">
				#{tScCurriculaId,jdbcType=CHAR},
			</if>
			<if test="tScTeacherId != null">
				#{tScTeacherId,jdbcType=VARCHAR},
			</if>
			<if test="tScClassId != null">
				#{tScClassId,jdbcType=CHAR},
			</if>
			<if test="tScSemesterId != null">
				#{tScSemesterId,jdbcType=CHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.topview.school.po.CurriculaVariable">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		update t_sc_curricula_variable
		<set>
			<if test="tScCurriculaId != null and tScCurriculaId != ''">
				t_sc_curricula_id = #{tScCurriculaId,jdbcType=CHAR},
			</if>
			<if test="tScTeacherId != null and tScTeacherId != ''">
				t_sc_teacher_id = #{tScTeacherId,jdbcType=VARCHAR},
			</if>
			<if test="tScClassId != null and tScClassId != ''">
				t_sc_class_id = #{tScClassId,jdbcType=CHAR},
			</if>
			<if test="tScSemesterId != null and tScSemesterId != ''">
				t_sc_semester_id = #{tScSemesterId,jdbcType=CHAR},
			</if>
			<if test="createTime != null and createTime != ''">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		where id = #{id,jdbcType=CHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.topview.school.po.CurriculaVariable">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		update t_sc_curricula_variable
		set t_sc_curricula_id =
		#{tScCurriculaId,jdbcType=CHAR},
		t_sc_teacher_id =
		#{tScTeacherId,jdbcType=VARCHAR},
		t_sc_class_id =
		#{tScClassId,jdbcType=CHAR},
		t_sc_semester_id =
		#{tScSemesterId,jdbcType=CHAR},
		create_time =
		#{createTime,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=CHAR}
	</update>

	<select id="selectByParameters" resultMap="BaseResultMap">
		select * from t_sc_curricula_variable where 1 = 1
		<if test="params != null">
			<foreach item="item" index="key" collection="params.entrySet()">
				and ${key} = #{item}
			</foreach>
		</if>
		ORDER BY create_time desc
	</select>

	<select id="selectByClassId" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		select
		<include refid="Base_Column_List" />
		from t_sc_curricula_variable
		where t_sc_class_id =
		#{clazzId,jdbcType=CHAR}
	</select>

	<select id="selectByTeacherId" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 26 
			12:01:24 CST 2015. -->
		select *
		from t_sc_curricula_variable
		where t_sc_teacher_id =
		#{teacherId,jdbcType=CHAR}
	</select>

	<select id="selectByCurriculaIdAndClassId" parameterType="com.topview.school.po.CurriculaVariable"
		resultMap="BaseResultMap">
		select *
		from t_sc_curricula_variable
		where t_sc_curricula_id
		= #{tScCurriculaId,jdbcType=VARCHAR} and t_sc_class_id =
		#{tScClassId,jdbcType=CHAR}
	</select>

	<!-- 根据学期id和课程id查询选课情况 -->
	<select id="selectBySemesterIdAndCurricualId" parameterType="java.util.Map"
		resultMap="BaseResultMap">
		select *
		from t_sc_curricula_variable
		where t_sc_curricula_id
		= #{curriculaId,jdbcType=VARCHAR} and t_sc_semester_id =
		#{semesterId,jdbcType=CHAR}
	</select>




	<!-- 自定义返回类型 -->
	<resultMap id="curriculaVariableInfo2"
		type="com.topview.school.vo.curricula.CurriculaVariableInfo2">
		<id column="t_sc_curricula_variable.id" jdbcType="CHAR" property="id" />
		<result column="t_sc_curricula_variable.t_sc_curricula_id"
			jdbcType="CHAR" property="curriculaId" />
		<result column="t_sc_semester.id" jdbcType="VARCHAR" property="tScSemesterId" />
		<result column="t_sc_teacher.id" jdbcType="VARCHAR" property="tScTeacherId" />
		<result column="t_sc_class.id" jdbcType="VARCHAR" property="classId" />
		<result column="t_sc_subject.name" jdbcType="VARCHAR" property="subjectName" />
		<result column="t_sc_class.name" jdbcType="CHAR" property="clazzName" />
		<result column="t_sc_teacher.name" jdbcType="CHAR" property="teacherName" />
		<result column="t_sc_teacher.phone" jdbcType="CHAR" property="phone" />
	</resultMap>
	<select id="showCurriculaVariable" parameterType="java.util.Map"
		resultMap="curriculaVariableInfo2">
		select
		cv.id as id, cv.t_sc_curricula_id as curriculaId,
		s.`name` as
		subjectName,
		t.id as tScTeacherId,
		u.id as tScSemesterId,
		cu.`name` as curriculaName,
		c.`name` as clazzName,
		c.id as classId,
		t.`name`
		as teacherName, t.phone as phone
		from
		t_sc_curricula_variable cv,
		t_sc_curricula cu,
		t_sc_class c, t_sc_subject s, t_sc_teacher t,t_sc_semester u 
		where
		cv.t_sc_teacher_id = t.id and cv.t_sc_curricula_id = cu.id and
		cu.t_sc_subject_id = s.id
		and cv.t_sc_class_id = c.id 
		and cv.t_sc_semester_id = u.id 
		<if test= "classId != null and classId != ''">
			and c.id = #{classId}
		</if>
		<if test="semesterId != null and semesterId != ''">
			and cv.t_sc_semester_id = #{semesterId}
		</if>
		<if test="teacherId != null and teacherId != ''">
			and t.id = #{teacherId}
		</if>
		<if test="subjectId != null and subjectId != ''">
			and s.id = #{subjectId}
		</if>
		<if test="gradeId != null and gradeId != ''">
			and c.t_sc_grade_id = #{gradeId} 
		</if>
		
		
		<if test = "showTrunk == 0">		
		</if>
		<if test  = "showTrunk == 1">
					and s.trunk = '1'  
		</if>
		
		
		limit #{offset},
		#{limit}

	</select>
	<!-- 查询记录条数 -->
	<select id="selectCount" parameterType="java.util.Map"
		resultType="int">
		select
		count(*)
		from
		t_sc_curricula_variable cv,
		t_sc_curricula cu,
		t_sc_class c, t_sc_subject s, t_sc_teacher t
		where
		cv.t_sc_teacher_id =
		t.id and cv.t_sc_curricula_id = cu.id and
		cu.t_sc_subject_id = s.id
		and
		cv.t_sc_class_id = c.id
		<if test= "classId != null and classId != ''">
			and c.id = #{classId}
		</if>
		<if test="semesterId != null and semesterId != ''">
			and cv.t_sc_semester_id = #{semesterId}
		</if>
		<if test="teacherId != null and teacherId != ''">
			and t.id = #{teacherId}
		</if>
		<if test="subjectId != null and subjectId != ''">
			and s.id = #{subjectId}
		</if>
		<if test="gradeId != null and gradeId != ''">
			and c.t_sc_grade_id = #{gradeId}
		</if>
			and s.trunk='1'
	</select>





	<!-- 自定义返回类型2 -->
	<resultMap id="uploadCurriculaInfo"
		type="com.topview.school.vo.curricula.UploadCurriculaInfoVo">
		<id column="t_sc_curricula_variable.id" jdbcType="CHAR"
			property="curriculaVariableId" />
		<result column="t_sc_curricula_variable.t_sc_curricula_id"
			jdbcType="CHAR" property="curriculaId" />
		<result column="t_sc_curricula_variable.t_sc_class_id"
			jdbcType="CHAR" property="clazzId" />
		<result column="t_sc_subject.name" jdbcType="VARCHAR" property="subjectName" />
		<result column="t_sc_curricula.name" jdbcType="VARCHAR"
			property="curriculaName" />
		<result column="t_sc_curricula_variable.t_sc_semester_id"
			jdbcType="CHAR" property="semesterId" />
	</resultMap>
	<select id="selectBySemesterIdAndClazzId" parameterType="java.util.Map"
		resultMap="uploadCurriculaInfo">
		select
		cv.id as curriculaVariableId,
		cv.t_sc_curricula_id as
		curriculaId,
		cv.t_sc_class_id as clazzId,
		cv.t_sc_semester_id as
		semesterId,
		c.name as curriculaName,
		s.name as subjectName
		from t_sc_curricula_variable
		cv, t_sc_curricula c, t_sc_subject s
		where
		cv.t_sc_semester_id =
		#{semesterId}
		and
		cv.t_sc_class_id = #{clazzId}
		and
		cv.t_sc_curricula_id =
		c.id
		and
		c.t_sc_subject_id = s.id
		<if test="teacherId != null">
			and cv.t_sc_teacher_id = #{teacherId}
		</if>
	</select>
	<resultMap id="ChooseCurriculaInfo" type="com.topview.school.vo.curricula.ChooseCurriculaInfo">
			<result column="t_sc_class.id" jdbcType="VARCHAR" property="clazzId" />
			<result column="t_sc_class.name" jdbcType="VARCHAR" property="clazzName" />
			<result column="t_sc_grade.id" jdbcType="VARCHAR" property="gradeId" />
			<result column="t_sc_grade.name" jdbcType="VARCHAR" property="gradeName" />
			<result column="t_sc_class.sort_name" jdbcType="VARCHAR" property="sortName" />
			<result column="t_sc_teacher.id" jdbcType="VARCHAR" property="teacherId" />
			<result column="t_sc_teacher.name" jdbcType="VARCHAR" property="teacharName" />
			<result column="t_sc_curricula.id" jdbcType="VARCHAR" property="curriculaId" />
			<result column="t_sc_curricula.curriculaName" jdbcType="VARCHAR" property="curriculaName" />
	</resultMap>
	<select id = "getClazzCurriculaInfo" resultMap = "ChooseCurriculaInfo" parameterType = "java.util.Map">
			select
					c.id as clazzId,
					c.name as clazzName,
					c.sort_name as sortName,
					g.id as gradeId,
					g.name as gradeName,
					t.id as teacherId,
					t.name as teacherName,
					cu.id as curriculaId,
					cu.name as curriculaName
			from 
					t_sc_class c,
					t_sc_grade g,
					t_sc_teacher t,
					t_sc_curricula cu,
					t_sc_curricula_variable cv 
			where
					c.id = cv.t_sc_class_id and 
					t.id = cv.t_sc_teacher_id and 
					g.id = c.t_sc_grade_id and 
					cu.id = cv.t_sc_curricula_id and 
			<if test = "classId != null">
					cv.t_sc_class_id = #{classId,jdbcType = VARCHAR} and 
			</if>
			<if test = "curriculaId != null">
					cv.t_sc_curricula_id = #{curriculaId, jdbcType = VARCHAR}
			</if>
	</select>
	
	
	<select id="getCurriculaByTeacherAndSemesterId" parameterType="java.util.Map" resultMap="BaseResultMap">
		select 
		<include refid="Base_Column_List"/>
		from t_sc_curricula_variable cv 
		where 
		cv.t_sc_teacher_id=#{teacherId}
		and
		cv.t_sc_semester_id =
		#{semesterId}
		order by cv.create_time asc
	
	</select>
	
</mapper>